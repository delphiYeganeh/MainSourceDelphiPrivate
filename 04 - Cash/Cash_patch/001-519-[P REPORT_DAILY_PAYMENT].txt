BEGIN TRANSACTION
GO
IF EXISTS ( SELECT 1
            FROM   sysobjects 
            WHERE  id = object_id(N'[dbo].[REPORT_DAILY_PAYMENT]')
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [dbo].[REPORT_DAILY_PAYMENT]
END
GO

CREATE  procedure [dbo].[REPORT_DAILY_PAYMENT]
	@DATEFROM CHAR(10),
	@DATETO CHAR(10),
	@USERID INT
AS
	SELECT  PAYMENT.*,
			CREDITORACCOUNT.ACCOUNTTITLE AS CREDITORACCOUNTTITLE,
			DEBTORACCOUNT.ACCOUNTTITLE   AS DEBTORACCOUNTTITLE,
			PAYTYPE.PAYTYPETITLE,
			FINANCIALNOTE_Detail.NOTENO, 
			FINANCIALNOTE_MASTER.MATUREDATE, 
			FINANCIALNOTE_MASTER.AMOUNT FINANCIALNOTEAMOUNT,
			FINANCIALNOTETYPE.FINANCIALNOTETYPETITLE,
			USERS.FULLNAME,
			ISNULL(COMMENT,PAYTYPETITLE) COMMENT2
		FROM PAYMENT
			INNER JOIN PAYTYPE ON PAYMENT.PAYTYPEID = PAYTYPE.PAYTYPEID
			INNER JOIN ACCOUNT AS CREDITORACCOUNT ON PAYMENT.CREDITORACCOUNTID = CREDITORACCOUNT.ACCOUNTID
			INNER JOIN ACCOUNT AS DEBTORACCOUNT ON PAYMENT.DEBTORACCOUNTID = DEBTORACCOUNT.ACCOUNTID
			LEFT JOIN USERS ON PAYMENT.INSERTUSERID = USERS.USERID
			LEFT JOIN  FINANCIALNOTE_Detail ON PAYMENT.FINANCIALNOTE_DETAILID = FINANCIALNOTE_Detail.FinancialNote_DETAILID
			LEFT JOIN  FINANCIALNOTE_MASTER ON FINANCIALNOTE_Detail.FinancialNote_MasterID = FINANCIALNOTE_MASTER.FinancialNote_MasterID
			LEFT JOIN  FINANCIALNOTETYPE ON FINANCIALNOTE_MASTER.FINANCIALNOTETYPEID = FINANCIALNOTETYPE.FINANCIALNOTETYPEID
		WHERE (@USERID=0 OR USERID=@USERID) AND DATE BETWEEN @DATEFROM  AND @DATETO
GO

COMMIT
GO