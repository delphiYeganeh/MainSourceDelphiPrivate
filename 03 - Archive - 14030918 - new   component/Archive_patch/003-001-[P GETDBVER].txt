BEGIN TRANSACTION
GO
IF EXISTS ( SELECT 1
            FROM   sysobjects 
            WHERE  id = object_id(N'[dbo].[GETDBVER]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [dbo].[GETDBVER]
END
GO

CREATE PROCEDURE [dbo].[GETDBVER] 
	@VER VARCHAR(50) OUTPUT
AS
	SET @VER = ''
	IF EXISTS(SELECT 1 FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[DBO].[TBLAPPVER]') AND TYPE IN (N'U'))
	BEGIN
		IF EXISTS(SELECT 1 FROM TBLAPPVER)
			SELECT @VER = VER FROM TBLAPPVER ORDER BY CHANGEDATE DESC
	END
GO

COMMIT
GO